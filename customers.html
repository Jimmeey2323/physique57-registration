<html lang="en" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Momence Customer Management</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
    rel="stylesheet"
  />
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
  />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.min.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.min.js"></script>
  <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
  <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
  <style>
    :root {
      /* Premium Modern Color Palette */
      --primary-50: #eff6ff;
      --primary-100: #dbeafe;
      --primary-200: #bfdbfe;
      --primary-300: #93c5fd;
      --primary-400: #60a5fa;
      --primary-500: #3b82f6;
      --primary-600: #2563eb;
      --primary-700: #1d4ed8;
      --primary-800: #1e40af;
      --primary-900: #1e3a8a;
      
      /* Sophisticated Grays */
      --neutral-50: #fafafa;
      --neutral-100: #f5f5f5;
      --neutral-200: #e5e5e5;
      --neutral-300: #d4d4d4;
      --neutral-400: #a3a3a3;
      --neutral-500: #737373;
      --neutral-600: #525252;
      --neutral-700: #404040;
      --neutral-800: #262626;
      --neutral-900: #171717;
      
      /* Status Colors */
      --success-50: #f0fdf4;
      --success-500: #22c55e;
      --success-600: #16a34a;
      
      --warning-50: #fffbeb;
      --warning-500: #f59e0b;
      --warning-600: #d97706;
      
      --error-50: #fef2f2;
      --error-500: #ef4444;
      --error-600: #dc2626;
      
      /* Premium Shadows */
      --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
      --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
      --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
      --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
      --shadow-2xl: 0 25px 50px -12px rgb(0 0 0 / 0.25);
      
      /* Glass Morphism */
      --glass-bg: rgba(255, 255, 255, 0.95);
      --glass-border: rgba(255, 255, 255, 0.3);
      --glass-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.15);
      
      /* Premium Gradients */
      --gradient-primary: linear-gradient(135deg, var(--primary-600) 0%, var(--primary-700) 100%);
      --gradient-surface: linear-gradient(145deg, #ffffff 0%, #f8fafc 100%);
      --gradient-card: linear-gradient(145deg, #ffffff 0%, #fcfcfc 100%);
      
      /* Transitions */
      --transition-fast: 0.15s cubic-bezier(0.4, 0, 0.2, 1);
      --transition-normal: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      --transition-slow: 0.5s cubic-bezier(0.4, 0, 0.2, 1);
      
      /* Border Radius */
      --radius-sm: 8px;
      --radius-md: 12px;
      --radius-lg: 16px;
      --radius-xl: 20px;
      --radius-2xl: 24px;
    }

    [data-theme="dark"] {
      --primary-50: #1e3a8a;
      --primary-100: #1e40af;
      --primary-200: #1d4ed8;
      --primary-300: #2563eb;
      --primary-400: #3b82f6;
      --primary-500: #60a5fa;
      --primary-600: #93c5fd;
      --primary-700: #bfdbfe;
      --primary-800: #dbeafe;
      --primary-900: #eff6ff;
      
      --neutral-50: #171717;
      --neutral-100: #262626;
      --neutral-200: #404040;
      --neutral-300: #525252;
      --neutral-400: #737373;
      --neutral-500: #a3a3a3;
      --neutral-600: #d4d4d4;
      --neutral-700: #e5e5e5;
      --neutral-800: #f5f5f5;
      --neutral-900: #fafafa;
      
      --glass-bg: rgba(0, 0, 0, 0.4);
      --glass-border: rgba(255, 255, 255, 0.1);
      --gradient-surface: linear-gradient(145deg, #1a1a1a 0%, #0f0f0f 100%);
      --gradient-card: linear-gradient(145deg, #262626 0%, #171717 100%);
    }

    * {
      box-sizing: border-box;
    }

    html {
      scroll-behavior: smooth;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
      background: var(--gradient-surface);
      min-height: 100vh;
      color: var(--neutral-800);
      transition: all var(--transition-normal);
      font-feature-settings: 'cv02', 'cv03', 'cv04', 'cv11';
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      letter-spacing: -0.01em;
    }
    /* Premium Card Design */
    .premium-card {
      background: var(--gradient-card);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: var(--radius-xl);
      box-shadow: var(--shadow-lg);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      transition: all var(--transition-normal);
      position: relative;
      overflow: hidden;
    }

    .premium-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 1px;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
    }

    .premium-card:hover {
      transform: translateY(-4px);
      box-shadow: var(--shadow-2xl);
      border-color: rgba(255, 255, 255, 0.2);
    }

    /* Enhanced Buttons */
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      padding: 0.875rem 1.75rem;
      border-radius: var(--radius-md);
      font-weight: 600;
      font-size: 0.875rem;
      line-height: 1.25rem;
      transition: all var(--transition-fast);
      cursor: pointer;
      border: none;
      text-decoration: none;
      position: relative;
      overflow: hidden;
      white-space: nowrap;
      user-select: none;
      text-transform: none;
      letter-spacing: 0.025em;
    }

    .btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      transition: left var(--transition-normal);
    }

    .btn:hover::before {
      left: 100%;
    }

    .btn-primary {
      background: var(--gradient-primary);
      color: white;
      box-shadow: var(--shadow-md);
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-lg);
    }

    .btn-secondary {
      background: var(--neutral-100);
      color: var(--neutral-800);
      border: 1px solid var(--neutral-200);
    }

    .btn-secondary:hover {
      background: var(--neutral-200);
      transform: translateY(-1px);
      box-shadow: var(--shadow-sm);
    }

    .btn-ghost {
      background: transparent;
      color: var(--neutral-600);
      border: 1px solid var(--neutral-300);
    }

    .btn-ghost:hover {
      background: var(--neutral-100);
      color: var(--neutral-800);
    }

    /* Loading Spinner */
    .loading-spinner {
      display: inline-block;
      width: 1rem;
      height: 1rem;
      border: 2px solid transparent;
      border-top: 2px solid currentColor;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Premium Status Badges */
    .badge {
      display: inline-flex;
      align-items: center;
      gap: 0.375rem;
      padding: 0.375rem 0.875rem;
      border-radius: 9999px;
      font-size: 0.75rem;
      font-weight: 600;
      font-feature-settings: 'tnum';
      letter-spacing: 0.025em;
    }

    .badge-success {
      background: var(--success-50);
      color: var(--success-600);
      border: 1px solid rgba(34, 197, 94, 0.2);
    }

    .badge-warning {
      background: var(--warning-50);
      color: var(--warning-600);
      border: 1px solid rgba(245, 158, 11, 0.2);
    }

    .badge-error {
      background: var(--error-50);
      color: var(--error-600);
      border: 1px solid rgba(239, 68, 68, 0.2);
    }

    /* Premium Form Controls */
    .form-input {
      width: 100%;
      padding: 0.875rem 1.125rem;
      border: 2px solid var(--neutral-200);
      border-radius: var(--radius-md);
      background: white;
      color: var(--neutral-800);
      font-size: 0.875rem;
      font-weight: 500;
      transition: all var(--transition-fast);
      font-feature-settings: 'tnum';
    }

    .form-input:focus {
      outline: none;
      border-color: var(--primary-500);
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
      background: white;
    }

    .form-input::placeholder {
      color: var(--neutral-400);
      font-weight: 400;
    }

    /* Premium Dropdown */
    .dropdown {
      position: relative;
      display: inline-block;
    }

    .dropdown-content {
      position: absolute;
      top: 100%;
      left: 0;
      z-index: 50;
      min-width: 240px;
      background: white;
      border: 1px solid var(--neutral-200);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-xl);
      opacity: 0;
      visibility: hidden;
      transform: translateY(-12px) scale(0.95);
      transition: all var(--transition-fast);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
    }

    .dropdown.active .dropdown-content {
      opacity: 1;
      visibility: visible;
      transform: translateY(0) scale(1);
    }

    .dropdown-item {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      width: 100%;
      padding: 0.875rem 1.125rem;
      text-align: left;
      color: var(--neutral-700);
      text-decoration: none;
      transition: all var(--transition-fast);
      border: none;
      background: none;
      cursor: pointer;
      font-weight: 500;
      font-size: 0.875rem;
    }

    .dropdown-item:hover {
      background: var(--neutral-50);
      color: var(--neutral-900);
    }

    .dropdown-item:first-child {
      border-radius: var(--radius-lg) var(--radius-lg) 0 0;
    }

    .dropdown-item:last-child {
      border-radius: 0 0 var(--radius-lg) var(--radius-lg);
    }
    /* Toast Notifications */
    .toast-container {
      position: fixed;
      top: 1rem;
      right: 1rem;
      z-index: 1000;
      pointer-events: none;
    }

    .toast {
      background: white;
      border: 1px solid var(--secondary-200);
      border-radius: 12px;
      padding: 1rem 1.5rem;
      margin-bottom: 0.5rem;
      box-shadow: var(--shadow-lg);
      pointer-events: auto;
      transform: translateX(100%);
      opacity: 0;
      transition: all var(--transition-normal);
      min-width: 300px;
    }

    .toast.show {
      transform: translateX(0);
      opacity: 1;
    }

    .toast-success {
      border-left: 4px solid var(--success-500);
    }

    .toast-error {
      border-left: 4px solid var(--error-500);
    }

    .toast-warning {
      border-left: 4px solid var(--warning-500);
    }

    /* Theme Toggle */
    .theme-toggle {
      position: relative;
      width: 60px;
      height: 30px;
      background: var(--secondary-300);
      border-radius: 15px;
      cursor: pointer;
      transition: background var(--transition-normal);
    }

    .theme-toggle::before {
      content: '';
      position: absolute;
      top: 3px;
      left: 3px;
      width: 24px;
      height: 24px;
      background: white;
      border-radius: 50%;
      transition: transform var(--transition-normal);
      box-shadow: var(--shadow-sm);
    }

    .theme-toggle.dark {
      background: var(--primary-600);
    }

    .theme-toggle.dark::before {
      transform: translateX(30px);
    }

    /* Premium Sidebar */
    .sidebar {
      width: 320px;
      background: var(--glass-bg);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border-right: 1px solid var(--glass-border);
      transition: all var(--transition-normal);
    }

    .sidebar-header {
      padding: 2rem 1.5rem;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .sidebar-logo {
      width: 48px;
      height: 48px;
      background: var(--gradient-primary);
      border-radius: var(--radius-lg);
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: var(--shadow-md);
    }

    .sidebar-nav {
      padding: 1.5rem;
    }

    .sidebar-item {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 1rem 1.25rem;
      margin: 0.25rem 0;
      border-radius: var(--radius-lg);
      color: var(--neutral-600);
      text-decoration: none;
      transition: all var(--transition-fast);
      cursor: pointer;
      font-weight: 500;
      font-size: 0.875rem;
      position: relative;
      overflow: hidden;
    }

    .sidebar-item::before {
      content: '';
      position: absolute;
      left: 0;
      top: 0;
      bottom: 0;
      width: 4px;
      background: var(--gradient-primary);
      transform: scaleY(0);
      transition: transform var(--transition-fast);
      border-radius: 0 4px 4px 0;
    }

    .sidebar-item:hover::before,
    .sidebar-item.active::before {
      transform: scaleY(1);
    }

    .sidebar-item:hover,
    .sidebar-item.active {
      background: rgba(59, 130, 246, 0.08);
      color: var(--primary-700);
      transform: translateX(4px);
    }

    .sidebar-item i {
      width: 20px;
      text-align: center;
      font-size: 1rem;
    }

    /* Stats Cards */
    .stats-card {
      background: white;
      border: 1px solid var(--secondary-200);
      border-radius: 16px;
      padding: 1.5rem;
      box-shadow: var(--shadow-sm);
      transition: all var(--transition-fast);
    }

    .stats-card:hover {
      box-shadow: var(--shadow-md);
      transform: translateY(-2px);
    }

    /* Table Enhancements */
    .table-container {
      background: white;
      border: 1px solid var(--secondary-200);
      border-radius: 16px;
      overflow: hidden;
      box-shadow: var(--shadow-sm);
    }

    /* Enhanced Modal */
    .modal-backdrop {
      background: rgba(0, 0, 0, 0.4);
      backdrop-filter: blur(4px);
      -webkit-backdrop-filter: blur(4px);
    }

    .modal-content {
      background: var(--glass-bg);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border: 1px solid var(--glass-border);
      box-shadow: var(--shadow-xl);
    }

    /* Skeleton Loading */
    .skeleton {
      background: linear-gradient(90deg, var(--secondary-200) 25%, var(--secondary-100) 50%, var(--secondary-200) 75%);
      background-size: 200% 100%;
      animation: loading 1.5s infinite;
    }

    @keyframes loading {
      0% { background-position: 200% 0; }
      100% { background-position: -200% 0; }
    }

    /* Progress Bar */
    .progress-bar {
      width: 100%;
      height: 8px;
      background: var(--secondary-200);
      border-radius: 4px;
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--primary-500), var(--primary-600));
      border-radius: 4px;
      transition: width var(--transition-normal);
    }
    /* Responsive Design */
    @media (max-width: 768px) {
      .sidebar {
        transform: translateX(-100%);
        position: fixed;
        height: 100vh;
        z-index: 40;
      }
      
      .sidebar.open {
        transform: translateX(0);
      }
      
      .main-content {
        margin-left: 0 !important;
      }
      
      .premium-card {
        margin: 0 -1rem;
        border-radius: var(--radius-lg);
      }
      
      .stats-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 1rem;
      }
    }

    @media (max-width: 480px) {
      .stats-grid {
        grid-template-columns: 1fr;
      }
      
      .btn {
        padding: 0.75rem 1.25rem;
        font-size: 0.8rem;
      }
    }

    /* Enhanced Table Styling */
    table tbody tr {
      height: 60px;
      transition: all var(--transition-fast);
    }
    
    table tbody tr:hover {
      background: rgba(59, 130, 246, 0.02);
      transform: scale(1.002);
    }
    
    table th {
      position: sticky;
      top: 0;
      z-index: 10;
      background: var(--neutral-50);
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }
    
    /* Custom Scrollbar */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }
    
    ::-webkit-scrollbar-track {
      background: var(--neutral-100);
      border-radius: 4px;
    }
    
    ::-webkit-scrollbar-thumb {
      background: var(--neutral-300);
      border-radius: 4px;
      transition: background var(--transition-fast);
    }
    
    ::-webkit-scrollbar-thumb:hover {
      background: var(--neutral-400);
    }

    /* Button Disabled State */
    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none !important;
    }
    
    /* Premium Input Styling */
    input[type="text"]:focus,
    input[type="email"]:focus,
    input[type="tel"]:focus {
      transform: translateY(-1px);
      box-shadow: var(--shadow-lg);
    }
    
    /* Pagination Enhancement */
    #pagination button {
      font-weight: 600;
      border-radius: var(--radius-md);
      padding: 0.5rem 1rem;
      border: 1px solid var(--neutral-200);
      background: white;
      color: var(--neutral-700);
      transition: all var(--transition-fast);
    }
    
    #pagination button:hover:not(:disabled) {
      background: var(--primary-500);
      color: white;
      border-color: var(--primary-500);
      transform: translateY(-1px);
    }
    
    #pagination button:disabled {
      opacity: 0.4;
      cursor: not-allowed;
      background: var(--neutral-100);
    }
    
    #pagination button.active {
      background: var(--primary-500);
      color: white;
      border-color: var(--primary-500);
    }

    /* Animation Classes */
    .fade-in {
      animation: fadeIn 0.5s ease-out;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .slide-up {
      animation: slideUp 0.3s ease-out;
    }
    
    @keyframes slideUp {
      from { transform: translateY(100%); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    
    /* Glass morphism for overlays */
    .glass-overlay {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    /* Premium Focus States */
    *:focus {
      outline: 2px solid var(--primary-500);
      outline-offset: 2px;
    }
    
    *:focus:not(:focus-visible) {
      outline: none;
    }
    /* Profile card image */
    .profile-image {
      width: 96px;
      height: 96px;
      border-radius: 9999px;
      object-fit: cover;
      border: 3px solid #4338ca;
      box-shadow: 0 0 10px #4338caaa;
    }
    /* Customer fields badges */
    .customer-field-badge {
      background: #4338ca;
      border-radius: 0.375rem;
      padding: 0.25rem 0.5rem;
      font-size: 0.75rem;
      font-weight: 600;
      color: white;
      margin-right: 0.5rem;
      margin-bottom: 0.5rem;
      display: inline-block;
      user-select: none;
    }
    /* Modal scroll container */
    #modalBody {
      scrollbar-width: thin;
      scrollbar-color: #4338ca #e0e7ff;
    }
    /* Modal header */
    #subscriptionsModal h2 {
      font-weight: 700;
      font-size: 1.5rem;
      color: #1e293b;
    }
    /* Modal close button */
    #subscriptionsModal button[aria-label="Close modal"] {
      font-size: 2rem;
      font-weight: 700;
      color: #4338ca;
      background: transparent;
      border: none;
      cursor: pointer;
      transition: color 0.3s ease;
    }
    #subscriptionsModal button[aria-label="Close modal"]:hover {
      color: #6366f1;
    }
    /* Table header icons */
    thead th i {
      margin-left: 0.25rem;
      color: #a5b4fc;
      font-size: 0.75rem;
      vertical-align: middle;
    }
    /* Table cell text truncate */
    td.truncate {
      max-width: 150px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
    /* Action buttons in session bookings */
    .action-btn {
      font-size: 0.75rem;
      font-weight: 600;
      padding: 0.25rem 0.5rem;
      border-radius: 0.375rem;
      transition: background-color 0.3s ease;
      cursor: pointer;
      user-select: none;
      border: none;
      display: flex;
      align-items: center;
      gap: 0.25rem;
      justify-content: center;
      width: 100%;
    }
    .action-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    .btn-cancel {
      background-color: #dc2626;
      color: white;
    }
    .btn-cancel:hover:not(:disabled) {
      background-color: #b91c1c;
    }
    .btn-not-checked-in {
      background-color: #facc15;
      color: #1e293b;
    }
    .btn-not-checked-in:hover:not(:disabled) {
      background-color: #eab308;
    }
    .btn-checked-in {
      background-color: #16a34a;
      color: white;
    }
    .btn-checked-in:hover:not(:disabled) {
      background-color: #15803d;
    }
  </style>
  <script>
    let members = [];
    let filteredMembers = [];
    let selectedMembers = new Set();
    let currentPage = 0;
    const pageSize = 10;
    let accessToken = "";
    let refreshToken = "";
    let currentFilters = {
      search: "",
      status: "all",
      dateRange: null
    };
    let currentSort = { column: null, direction: "asc" };

    // Theme Management
    function toggleTheme() {
      const body = document.body;
      const toggle = document.getElementById('themeToggle');
      const currentTheme = body.getAttribute('data-theme');
      const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
      
      body.setAttribute('data-theme', newTheme);
      toggle.classList.toggle('dark', newTheme === 'dark');
      localStorage.setItem('theme', newTheme);
    }

    // Initialize theme from localStorage
    function initializeTheme() {
      const savedTheme = localStorage.getItem('theme') || 'light';
      document.body.setAttribute('data-theme', savedTheme);
      const toggle = document.getElementById('themeToggle');
      if (toggle) {
        toggle.classList.toggle('dark', savedTheme === 'dark');
      }
    }

    // Toast Notifications
    function showToast(message, type = 'success', duration = 3000) {
      const container = document.getElementById('toastContainer');
      const toast = document.createElement('div');
      toast.className = `toast toast-${type}`;
      toast.innerHTML = `
        <div class="flex items-center justify-between">
          <div class="flex items-center gap-2">
            <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'exclamation-triangle'}"></i>
            <span>${message}</span>
          </div>
          <button onclick="this.parentElement.parentElement.remove()" class="text-gray-400 hover:text-gray-600">
            <i class="fas fa-times"></i>
          </button>
        </div>
      `;
      
      container.appendChild(toast);
      
      // Show toast
      setTimeout(() => toast.classList.add('show'), 10);
      
      // Auto remove
      setTimeout(() => {
        toast.classList.remove('show');
        setTimeout(() => toast.remove(), 300);
      }, duration);
    }

    // Loading State Management
    function showLoading() {
      const tableBody = document.getElementById('membersTableBody');
      tableBody.innerHTML = '';
      
      // Create skeleton rows
      for (let i = 0; i < pageSize; i++) {
        const row = document.createElement('tr');
        row.className = 'border-b';
        row.innerHTML = `
          <td class="px-4 py-3"><div class="skeleton w-4 h-4 rounded"></div></td>
          <td class="px-4 py-3"><div class="skeleton w-8 h-4 rounded"></div></td>
          <td class="px-4 py-3"><div class="skeleton w-20 h-4 rounded"></div></td>
          <td class="px-4 py-3"><div class="skeleton w-20 h-4 rounded"></div></td>
          <td class="px-4 py-3"><div class="skeleton w-32 h-4 rounded"></div></td>
          <td class="px-4 py-3"><div class="skeleton w-24 h-4 rounded"></div></td>
          <td class="px-4 py-3"><div class="skeleton w-20 h-4 rounded"></div></td>
          <td class="px-4 py-3"><div class="skeleton w-20 h-4 rounded"></div></td>
          <td class="px-4 py-3"><div class="skeleton w-12 h-4 rounded"></div></td>
          <td class="px-4 py-3"><div class="skeleton w-12 h-4 rounded"></div></td>
          <td class="px-4 py-3"><div class="skeleton w-16 h-6 rounded-full"></div></td>
        `;
        tableBody.appendChild(row);
      }
    }

    // Dropdown Management
    function toggleDropdown(dropdownId) {
      const dropdown = document.getElementById(dropdownId);
      const allDropdowns = document.querySelectorAll('.dropdown');
      
      // Close other dropdowns
      allDropdowns.forEach(d => {
        if (d.id !== dropdownId) {
          d.classList.remove('active');
        }
      });
      
      dropdown.classList.toggle('active');
    }

    // Close dropdowns when clicking outside
    document.addEventListener('click', (e) => {
      if (!e.target.closest('.dropdown')) {
        document.querySelectorAll('.dropdown').forEach(d => d.classList.remove('active'));
      }
    });

    // Sidebar Management
    function toggleSidebar() {
      const sidebar = document.getElementById('sidebar');
      sidebar.classList.toggle('open');
    }

    // Filter Management
    function setStatusFilter(status) {
      currentFilters.status = status;
      const statusText = document.getElementById('statusFilterText');
      const statusMap = {
        'all': 'All Statuses',
        'active': 'Active Customers',
        'inactive': 'Inactive Customers',
        'new': 'New Customers'
      };
      statusText.textContent = statusMap[status];
      toggleDropdown('statusDropdown');
      updateActiveFilters();
    }

    function updateActiveFilters() {
      const container = document.getElementById('activeFilters');
      container.innerHTML = '';
      
      if (currentFilters.search) {
        addFilterTag('Search', currentFilters.search, () => {
          currentFilters.search = '';
          document.getElementById('searchInput').value = '';
          updateActiveFilters();
          applyFilters();
        });
      }
      
      if (currentFilters.status !== 'all') {
        const statusMap = {
          'active': 'Active Customers',
          'inactive': 'Inactive Customers',
          'new': 'New Customers'
        };
        addFilterTag('Status', statusMap[currentFilters.status], () => {
          setStatusFilter('all');
          applyFilters();
        });
      }
      
      if (currentFilters.dateRange) {
        addFilterTag('Date Range', currentFilters.dateRange, () => {
          currentFilters.dateRange = null;
          document.getElementById('dateRange').value = '';
          updateActiveFilters();
          applyFilters();
        });
      }
    }

    function addFilterTag(label, value, onRemove) {
      const container = document.getElementById('activeFilters');
      const tag = document.createElement('div');
      tag.className = 'inline-flex items-center gap-2 px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm';
      tag.innerHTML = `
        <span><strong>${label}:</strong> ${value}</span>
        <button onclick="this.closest('div').remove(); (${onRemove.toString()})();" class="text-blue-600 hover:text-blue-800">
          <i class="fas fa-times text-xs"></i>
        </button>
      `;
      container.appendChild(tag);
    }

    function applyFilters() {
      currentFilters.search = document.getElementById('searchInput').value.toLowerCase().trim();
      
      filteredMembers = members.filter(member => {
        // Search filter
        if (currentFilters.search) {
          const searchMatch = 
            (member.firstName && member.firstName.toLowerCase().includes(currentFilters.search)) ||
            (member.lastName && member.lastName.toLowerCase().includes(currentFilters.search)) ||
            (member.email && member.email.toLowerCase().includes(currentFilters.search)) ||
            (member.phoneNumber && member.phoneNumber.toLowerCase().includes(currentFilters.search));
          if (!searchMatch) return false;
        }
        
        // Status filter (simplified logic for demo)
        if (currentFilters.status !== 'all') {
          if (currentFilters.status === 'active' && (!member.totalVisits || member.totalVisits < 5)) return false;
          if (currentFilters.status === 'inactive' && member.totalVisits >= 5) return false;
          if (currentFilters.status === 'new' && member.totalVisits > 2) return false;
        }
        
        return true;
      });
      
      currentPage = 0;
      renderTable();
      updateActiveFilters();
      showToast(`Applied filters. ${filteredMembers.length} customers found.`, 'success');
    }

    function clearFilters() {
      currentFilters = { search: "", status: "all", dateRange: null };
      document.getElementById('searchInput').value = '';
      document.getElementById('dateRange').value = '';
      setStatusFilter('all');
      filteredMembers = [...members];
      currentPage = 0;
      renderTable();
      updateActiveFilters();
      showToast('All filters cleared.', 'success');
    }

    // Selection Management
    function toggleSelectAll() {
      const checkbox = document.getElementById('selectAll') || document.getElementById('headerCheckbox');
      const isChecked = checkbox.checked;
      
      if (isChecked) {
        const currentPageMembers = getCurrentPageMembers();
        currentPageMembers.forEach(member => selectedMembers.add(member.id));
      } else {
        selectedMembers.clear();
      }
      
      updateSelectionUI();
      renderTable();
    }

    function toggleMemberSelection(memberId) {
      if (selectedMembers.has(memberId)) {
        selectedMembers.delete(memberId);
      } else {
        selectedMembers.add(memberId);
      }
      updateSelectionUI();
    }

    function updateSelectionUI() {
      const selectedCount = selectedMembers.size;
      document.getElementById('selectedCount').textContent = `${selectedCount} selected`;
      
      const bulkActionsBtn = document.getElementById('bulkActionsBtn');
      bulkActionsBtn.disabled = selectedCount === 0;
      
      // Update checkboxes
      const checkboxes = document.querySelectorAll('input[type="checkbox"][data-member-id]');
      checkboxes.forEach(cb => {
        cb.checked = selectedMembers.has(parseInt(cb.dataset.memberId));
      });
      
      // Update select all checkbox
      const selectAllCheckbox = document.getElementById('selectAll') || document.getElementById('headerCheckbox');
      const currentPageMembers = getCurrentPageMembers();
      const allCurrentPageSelected = currentPageMembers.length > 0 && 
        currentPageMembers.every(member => selectedMembers.has(member.id));
      selectAllCheckbox.checked = allCurrentPageSelected;
      selectAllCheckbox.indeterminate = selectedCount > 0 && !allCurrentPageSelected;
    }

    function getCurrentPageMembers() {
      const start = currentPage * pageSize;
      const end = start + pageSize;
      return filteredMembers.slice(start, end);
    }

    // Quick Sort Functions
    function quickSort(column) {
      sortTable(column);
      toggleDropdown('sortDropdown');
      showToast(`Sorted by ${column}`, 'success');
    }

    // Export Functions
    function exportToCSV() {
      const dataToExport = selectedMembers.size > 0 ? 
        members.filter(m => selectedMembers.has(m.id)) : 
        filteredMembers;
      
      const csvContent = generateCSV(dataToExport);
      downloadFile(csvContent, 'customers.csv', 'text/csv');
      toggleDropdown('exportDropdown');
      showToast(`Exported ${dataToExport.length} customers to CSV`, 'success');
    }

    function exportToPDF() {
      showToast('PDF export feature coming soon!', 'warning');
      toggleDropdown('exportDropdown');
    }

    function exportToExcel() {
      showToast('Excel export feature coming soon!', 'warning');
      toggleDropdown('exportDropdown');
    }

    function generateCSV(data) {
      const headers = ['ID', 'First Name', 'Last Name', 'Email', 'Phone', 'First Contact', 'Last Activity', 'Total Bookings', 'Total Visits'];
      const csvRows = [headers.join(',')];
      
      data.forEach(member => {
        const row = [
          member.id,
          `"${member.firstName || ''}"`,
          `"${member.lastName || ''}"`,
          `"${member.email || ''}"`,
          `"${member.phoneNumber || ''}"`,
          `"${formatDate(member.firstSeen)}"`,
          `"${formatDate(member.lastSeen)}"`,
          member.visits?.total || 0,
          member.visits?.totalVisits || 0
        ];
        csvRows.push(row.join(','));
      });
      
      return csvRows.join('\n');
    }

    function downloadFile(content, filename, contentType) {
      const blob = new Blob([content], { type: contentType });
      const url = window.URL.createObjectURL(blob);
      const link = document.createElement('a');
      link.href = url;
      link.download = filename;
      link.click();
      window.URL.revokeObjectURL(url);
    }

    // Bulk Actions
    function bulkExport() {
      if (selectedMembers.size === 0) {
        showToast('Please select customers to export', 'warning');
        return;
      }
      exportToCSV();
      toggleDropdown('bulkActionsDropdown');
    }

    function bulkDelete() {
      if (selectedMembers.size === 0) {
        showToast('Please select customers to remove', 'warning');
        return;
      }
      
      if (confirm(`Are you sure you want to remove ${selectedMembers.size} selected customers?`)) {
        showToast('Bulk removal feature would be implemented here', 'warning');
      }
      toggleDropdown('bulkActionsDropdown');
    }

    function bulkEmail() {
      if (selectedMembers.size === 0) {
        showToast('Please select customers to contact', 'warning');
        return;
      }
      showToast('Bulk communication feature coming soon!', 'warning');
      toggleDropdown('bulkActionsDropdown');
    }

    // Chart Functions
    function initializeCharts() {
      initializeMemberGrowthChart();
      initializeSessionTypesChart();
    }

    function initializeMemberGrowthChart() {
      const ctx = document.getElementById('memberGrowthChart');
      if (!ctx) return;
      
      new Chart(ctx, {
        type: 'line',
        data: {
          labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
          datasets: [{
            label: 'New Customers',
            data: [45, 62, 58, 78, 95, 88],
            borderColor: '#3b82f6',
            backgroundColor: 'rgba(59, 130, 246, 0.1)',
            borderWidth: 3,
            fill: true,
            tension: 0.4,
            pointBackgroundColor: '#3b82f6',
            pointBorderColor: '#ffffff',
            pointBorderWidth: 2,
            pointRadius: 6
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              display: false
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              grid: {
                color: 'rgba(0, 0, 0, 0.05)'
              },
              ticks: {
                color: '#64748b'
              }
            },
            x: {
              grid: {
                display: false
              },
              ticks: {
                color: '#64748b'
              }
            }
          }
        }
      });
    }

    function initializeSessionTypesChart() {
      const ctx = document.getElementById('sessionTypesChart');
      if (!ctx) return;
      
      new Chart(ctx, {
        type: 'doughnut',
        data: {
          labels: ['Premium', 'Standard', 'Basic', 'Trial'],
          datasets: [{
            data: [35, 30, 25, 10],
            backgroundColor: [
              '#3b82f6',
              '#10b981',
              '#f59e0b',
              '#ef4444'
            ],
            borderWidth: 0,
            borderRadius: 8
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'bottom',
              labels: {
                usePointStyle: true,
                padding: 20,
                color: '#64748b',
                font: {
                  weight: 600
                }
              }
            }
          }
        }
      });
    }

    // Statistics Update
    function updateStatistics() {
      document.getElementById('totalMembersCount').textContent = members.length.toLocaleString();
      
      // Calculate active customers (mock data)
      const activeCustomers = Math.floor(members.length * 0.75);
      document.getElementById('activeSubscriptionsCount').textContent = activeCustomers.toLocaleString();
      
      // New customers this month (mock data)
      document.getElementById('todaysSessionsCount').textContent = Math.floor(Math.random() * 50 + 15);
    }

    async function authenticate() {
      try {
        const authResponse = await fetch(
          "https://api.momence.com/api/v2/auth/token",
          {
            method: "POST",
            headers: {
              accept: "application/json",
              authorization:
                "Basic YXBpLTEzNzUyLUtYRTBPRFVQR3BTdkVrR1E6dlpPWkRGSHk0dEtOeWYzOHpvZ0JtQnRZSElSaTJldVo=",
              "content-type": "application/x-www-form-urlencoded",
            },
            body: new URLSearchParams({
              grant_type: "password",
              username: "physique57mumbai1@gmail.com",
              password: "Jimmeey@123",
            }),
          }
        );

        const authData = await authResponse.json();
        accessToken = authData.access_token;
        refreshToken = authData.refreshToken;

        await fetchMembers();
      } catch (error) {
        console.error("Error during authentication:", error);
      }
    }

    async function refreshAccessToken() {
      try {
        const refreshResponse = await fetch(
          "https://api.momence.com/api/v2/auth/token",
          {
            method: "POST",
            headers: {
              accept: "application/json",
              authorization:
                "Basic YXBpLTEzNzUyLUtYRTBPRFVQR3BTdkVrR1E6dlpPWkRGSHk0dEtOeWYzOHpvZ0JtQnRZSElSaTJldVo=",
              "content-type": "application/x-www-form-urlencoded",
            },
            body: new URLSearchParams({
              grant_type: "refresh_token",
              refresh_token: refreshToken,
            }),
          }
        );

        const refreshData = await refreshResponse.json();
        accessToken = refreshData.access_token;
        refreshToken = refreshData.refreshToken;
      } catch (error) {
        console.error("Error refreshing access token:", error);
      }
    }

    async function fetchMembers() {
      try {
        let page = 0;
        let hasMoreData = true;

        // Fetch the first page to display immediately
        const firstPageResponse = await fetch(
          `https://api.momence.com/api/v2/host/members?page=${page}&pageSize=100`,
          {
            method: "GET",
            headers: {
              accept: "application/json",
              authorization: `Bearer ${accessToken}`,
            },
          }
        );

        if (firstPageResponse.status === 401) {
          await refreshAccessToken();
          return fetchMembers();
        }

        const firstPageData = await firstPageResponse.json();
        members = firstPageData.payload;
        filteredMembers = [...members];
        renderTable();
        updateStatistics();

        // Fetch the rest of the pages in the background
        page++;
        while (hasMoreData) {
          const membersResponse = await fetch(
            `https://api.momence.com/api/v2/host/members?page=${page}&pageSize=100`,
            {
              method: "GET",
              headers: {
                accept: "application/json",
                authorization: `Bearer ${accessToken}`,
              },
            }
          );

          if (membersResponse.status === 401) {
            await refreshAccessToken();
            continue;
          }

          const membersData = await membersResponse.json();
          members = members.concat(membersData.payload);
          filteredMembers = [...members];
          updateStatistics();

          if (membersData.payload.length < 100) {
            hasMoreData = false;
          } else {
            page++;
          }
        }
      } catch (error) {
        console.error("Error fetching members:", error);
      }
    }

    async function fetchMemberDetails(memberId) {
      try {
        const response = await fetch(
          `https://api.momence.com/api/v2/host/members/${memberId}`,
          {
            method: "GET",
            headers: {
              accept: "application/json",
              authorization: `Bearer ${accessToken}`,
            },
          }
        );

        if (response.status === 401) {
          await refreshAccessToken();
          return fetchMemberDetails(memberId);
        }

        if (!response.ok) {
          throw new Error(`Failed to fetch member details: ${response.status}`);
        }

        const data = await response.json();
        return data;
      } catch (error) {
        console.error("Error fetching member details:", error);
        return null;
      }
    }

    async function fetchActiveSubscriptions(memberId) {
      try {
        const response = await fetch(
          `https://api.momence.com/api/v2/host/members/${memberId}/bought-memberships/active?page=0&pageSize=200`,
          {
            method: "GET",
            headers: {
              accept: "application/json",
              authorization: `Bearer ${accessToken}`,
            },
          }
        );

        if (response.status === 401) {
          await refreshAccessToken();
          return fetchActiveSubscriptions(memberId);
        }

        if (!response.ok) {
          throw new Error(
            `Failed to fetch active subscriptions: ${response.status}`
          );
        }

        const data = await response.json();
        return data.payload;
      } catch (error) {
        console.error("Error fetching active subscriptions:", error);
        return null;
      }
    }

    async function fetchSessionBookings(memberId) {
      try {
        const response = await fetch(
          `https://api.momence.com/api/v2/host/members/${memberId}/sessions?page=0&pageSize=100&sortOrder=DESC&sortBy=startsAt`,
          {
            method: "GET",
            headers: {
              accept: "application/json",
              authorization: `Bearer ${accessToken}`,
            },
          }
        );

        if (response.status === 401) {
          await refreshAccessToken();
          return fetchSessionBookings(memberId);
        }

        if (!response.ok) {
          throw new Error(`Failed to fetch session bookings: ${response.status}`);
        }

        const data = await response.json();
        return data.payload;
      } catch (error) {
        console.error("Error fetching session bookings:", error);
        return null;
      }
    }

    async function deleteSessionBooking(bookingId) {
      try {
        const response = await fetch(
          `https://api.momence.com/api/v2/host/session-bookings/${bookingId}`,
          {
            method: "DELETE",
            headers: {
              authorization: `Bearer ${accessToken}`,
              "content-type": "application/json",
            },
            body: JSON.stringify({
              refund: true,
              disableNotifications: true,
              isLateCancellation: true,
            }),
          }
        );

        if (response.status === 401) {
          await refreshAccessToken();
          return deleteSessionBooking(bookingId);
        }

        if (!response.ok) {
          throw new Error(`Failed to delete session booking: ${response.status}`);
        }

        return true;
      } catch (error) {
        console.error("Error deleting session booking:", error);
        alert("Failed to cancel session booking.");
        return false;
      }
    }

    async function markSessionBookingNotCheckedIn(bookingId) {
      try {
        const response = await fetch(
          `https://api.momence.com/api/v2/host/session-bookings/${bookingId}/check-in`,
          {
            method: "DELETE",
            headers: {
              authorization: `Bearer ${accessToken}`,
            },
          }
        );

        if (response.status === 401) {
          await refreshAccessToken();
          return markSessionBookingNotCheckedIn(bookingId);
        }

        if (!response.ok) {
          throw new Error(
            `Failed to mark session booking as not checked-in: ${response.status}`
          );
        }

        return true;
      } catch (error) {
        console.error("Error marking session booking as not checked-in:", error);
        alert("Failed to mark session booking as not checked-in.");
        return false;
      }
    }

    async function markSessionBookingCheckedIn(bookingId) {
      try {
        const response = await fetch(
          `https://api.momence.com/api/v2/host/session-bookings/${bookingId}/check-in`,
          {
            method: "POST",
            headers: {
              authorization: `Bearer ${accessToken}`,
            },
          }
        );

        if (response.status === 401) {
          await refreshAccessToken();
          return markSessionBookingCheckedIn(bookingId);
        }

        if (!response.ok) {
          throw new Error(
            `Failed to mark session booking as checked-in: ${response.status}`
          );
        }

        return true;
      } catch (error) {
        console.error("Error marking session booking as checked-in:", error);
        alert("Failed to mark session booking as checked-in.");
        return false;
      }
    }

    async function onRowClick(member) {
      const [memberDetails, subscriptions, sessions] = await Promise.all([
        fetchMemberDetails(member.id),
        fetchActiveSubscriptions(member.id),
        fetchSessionBookings(member.id),
      ]);
      showSubscriptionsModal(memberDetails, subscriptions, sessions);
    }

    function renderTable() {
      const tableBody = document.getElementById("membersTableBody");
      tableBody.innerHTML = "";

      const start = currentPage * pageSize;
      const end = start + pageSize;
      const paginatedMembers = filteredMembers.slice(start, end);

      paginatedMembers.forEach((member) => {
        const isSelected = selectedMembers.has(member.id);
        const statusBadge = getStatusBadge(member);
        
        const row = document.createElement("tr");
        row.classList.add(
          "border-b",
          "hover:bg-blue-50",
          "transition",
          "duration-200",
          "ease-in-out",
          "cursor-pointer",
          "select-none"
        );
        
        if (isSelected) {
          row.classList.add("bg-blue-50");
        }

        row.innerHTML = `
          <td class="px-4 py-3">
            <input type="checkbox" ${isSelected ? 'checked' : ''} 
                   data-member-id="${member.id}" 
                   onchange="toggleMemberSelection(${member.id})"
                   class="rounded border-gray-300">
          </td>
          <td class="px-4 py-3 text-sm font-semibold text-gray-900">${member.id}</td>
          <td class="px-4 py-3 text-sm font-medium text-gray-900">${member.firstName || ""}</td>
          <td class="px-4 py-3 text-sm font-medium text-gray-900">${member.lastName || ""}</td>
          <td class="px-4 py-3 text-sm truncate max-w-[150px] text-gray-700" title="${member.email || ""}">${member.email || ""}</td>
          <td class="px-4 py-3 text-sm text-gray-700">${getCountryFlag(
            member.phoneNumber || ""
          )} <span class="align-middle">${member.phoneNumber || ""}</span></td>
          <td class="px-4 py-3 text-sm text-gray-600">${formatDate(member.firstSeen)}</td>
          <td class="px-4 py-3 text-sm text-gray-600">${formatDate(member.lastSeen)}</td>
          <td class="px-4 py-3 text-sm font-semibold text-gray-900">${member.visits?.total ?? 0}</td>
          <td class="px-4 py-3 text-sm font-semibold text-gray-900">${member.visits?.totalVisits ?? 0}</td>
          <td class="px-4 py-3">${statusBadge}</td>
        `;

        row.addEventListener("click", (e) => {
          if (e.target.type !== 'checkbox') {
            onRowClick(member);
          }
        });

        tableBody.appendChild(row);
      });

      renderPagination();
      updateSelectionUI();
      updatePaginationInfo();
    }

    function getStatusBadge(member) {
      const totalVisits = member.visits?.totalVisits || 0;
      if (totalVisits === 0) {
        return '<span class="badge badge-error">New</span>';
      } else if (totalVisits < 5) {
        return '<span class="badge badge-warning">Active</span>';
      } else {
        return '<span class="badge badge-success">Regular</span>';
      }
    }

    function updatePaginationInfo() {
      const total = filteredMembers.length;
      const start = total === 0 ? 0 : (currentPage * pageSize) + 1;
      const end = Math.min((currentPage + 1) * pageSize, total);
      
      document.getElementById('showingStart').textContent = start;
      document.getElementById('showingEnd').textContent = end;
      document.getElementById('totalRecords').textContent = total;
    }

    function showSubscriptionsModal(member, subscriptions, sessions) {
      const modal = document.getElementById("subscriptionsModal");
      const modalTitle = document.getElementById("modalTitle");
      const modalBody = document.getElementById("modalBody");

      modalTitle.textContent = `Member Profile & Details - ${member.firstName || ""} ${member.lastName || ""} (ID: ${member.id})`;

      // Profile card with grid layout
      let profilePic =
        member.pictureUrl && member.pictureUrl.trim() !== ""
          ? member.pictureUrl
          : "https://placehold.co/96x96/png?text=No+Image";

      let customerFieldsHtml = "";
      if (member.customerFields && member.customerFields.length > 0) {
        customerFieldsHtml = member.customerFields
          .map(
            (field) =>
              `<span class="customer-field-badge" title="${field.label}: ${field.value}">${field.label}: ${field.value}</span>`
          )
          .join("");
      } else {
        customerFieldsHtml = `<span class="text-gray-500 italic">No custom fields</span>`;
      }

      let html = `
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
        <div class="flex flex-col items-center md:items-start text-center md:text-left">
          <img src="${profilePic}" alt="Profile picture of ${member.firstName} ${member.lastName}" class="profile-image mb-4" />
          <h3 class="text-3xl font-extrabold text-gray-900">${member.firstName || ""} ${member.lastName || ""}</h3>
          <p class="text-gray-700 font-semibold mb-1"><i class="fas fa-envelope mr-2 text-indigo-600"></i>${member.email || "-"}</p>
          <p class="text-gray-700 font-semibold mb-1"><i class="fas fa-phone-alt mr-2 text-indigo-600"></i>${member.phoneNumber || "-"}</p>
          <p class="text-gray-500 text-sm mb-1"><i class="fas fa-calendar-alt mr-2"></i>First Seen: ${formatDate(member.firstSeen)}</p>
          <p class="text-gray-500 text-sm mb-1"><i class="fas fa-calendar-check mr-2"></i>Last Seen: ${formatDate(member.lastSeen)}</p>
          <div class="mt-3 w-full">
            <h4 class="text-indigo-700 font-semibold mb-2">Custom Fields</h4>
            <div>${customerFieldsHtml}</div>
          </div>
        </div>
        <div class="md:col-span-2 grid grid-cols-2 gap-6 text-gray-800 font-semibold text-sm">
          <div class="bg-indigo-50 rounded-lg p-4 shadow-sm flex items-center gap-3">
            <i class="fas fa-calendar-check text-indigo-600 text-xl"></i>
            <div>
              <div>Appointments Booked</div>
              <div class="text-lg font-bold">${member.appointments ?? "-"}</div>
            </div>
          </div>
          <div class="bg-indigo-50 rounded-lg p-4 shadow-sm flex items-center gap-3">
            <i class="fas fa-user-check text-indigo-600 text-xl"></i>
            <div>
              <div>Appointments Checked In</div>
              <div class="text-lg font-bold">${member.appointmentsVisits ?? "-"}</div>
            </div>
          </div>
          <div class="bg-indigo-50 rounded-lg p-4 shadow-sm flex items-center gap-3">
            <i class="fas fa-calendar-alt text-indigo-600 text-xl"></i>
            <div>
              <div>Session Bookings</div>
              <div class="text-lg font-bold">${member.bookings ?? "-"}</div>
            </div>
          </div>
          <div class="bg-indigo-50 rounded-lg p-4 shadow-sm flex items-center gap-3">
            <i class="fas fa-user-clock text-indigo-600 text-xl"></i>
            <div>
              <div>Session Bookings Checked In</div>
              <div class="text-lg font-bold">${member.bookingsVisits ?? "-"}</div>
            </div>
          </div>
          <div class="bg-indigo-50 rounded-lg p-4 shadow-sm flex items-center gap-3">
            <i class="fas fa-door-open text-indigo-600 text-xl"></i>
            <div>
              <div>Open Area Visits</div>
              <div class="text-lg font-bold">${member.openAreaVisits ?? "-"}</div>
            </div>
          </div>
          <div class="bg-indigo-50 rounded-lg p-4 shadow-sm flex items-center gap-3">
            <i class="fas fa-layer-group text-indigo-600 text-xl"></i>
            <div>
              <div>Total Bookings</div>
              <div class="text-lg font-bold">${member.total ?? "-"}</div>
            </div>
          </div>
          <div class="bg-indigo-50 rounded-lg p-4 shadow-sm flex items-center gap-3 col-span-2">
            <i class="fas fa-users text-indigo-600 text-xl"></i>
            <div>
              <div>Total Visits</div>
              <div class="text-lg font-bold">${member.totalVisits ?? "-"}</div>
            </div>
          </div>
        </div>
      </div>`;

      // Subscriptions Section
      html += `<h3 class="text-2xl font-semibold mb-3 text-gray-900 border-b border-gray-300 pb-1">Active Subscriptions & Packs</h3>`;
      if (!subscriptions || subscriptions.length === 0) {
        html +=
          '<p class="text-gray-600 mb-6">No active subscriptions or packs found for this member.</p>';
      } else {
        html += `<div class="overflow-x-auto max-h-96 overflow-y-auto mb-6 rounded-lg shadow border border-gray-300">
          <table class="min-w-full bg-white rounded-lg">
            <thead class="bg-gray-100 sticky top-0">
              <tr>
                <th class="px-3 py-1 border border-gray-300 text-left text-xs font-semibold">ID</th>
                <th class="px-3 py-1 border border-gray-300 text-left text-xs font-semibold">Type</th>
                <th class="px-3 py-1 border border-gray-300 text-left text-xs font-semibold">Membership Name</th>
                <th class="px-3 py-1 border border-gray-300 text-left text-xs font-semibold">Start Date</th>
                <th class="px-3 py-1 border border-gray-300 text-left text-xs font-semibold">End Date</th>
                <th class="px-3 py-1 border border-gray-300 text-left text-xs font-semibold">Event Credits Left</th>
                <th class="px-3 py-1 border border-gray-300 text-left text-xs font-semibold">Event Credits Total</th>
                <th class="px-3 py-1 border border-gray-300 text-left text-xs font-semibold">Money Credits Left</th>
                <th class="px-3 py-1 border border-gray-300 text-left text-xs font-semibold">Money Credits Total</th>
                <th class="px-3 py-1 border border-gray-300 text-left text-xs font-semibold">Usage Limit Sessions</th>
                <th class="px-3 py-1 border border-gray-300 text-left text-xs font-semibold">Used Sessions</th>
                <th class="px-3 py-1 border border-gray-300 text-left text-xs font-semibold">Usage Limit Appointments</th>
                <th class="px-3 py-1 border border-gray-300 text-left text-xs font-semibold">Used Appointments</th>
                <th class="px-3 py-1 border border-gray-300 text-left text-xs font-semibold">Auto Renewing</th>
                <th class="px-3 py-1 border border-gray-300 text-left text-xs font-semibold">Disabled</th>
              </tr>
            </thead>
            <tbody>`;

        subscriptions.forEach((sub) => {
          const m = sub.membership || {};
          html += `<tr class="border-b border-gray-300 hover:bg-indigo-50">
              <td class="px-3 py-1 border border-gray-300 text-xs">${sub.id}</td>
              <td class="px-3 py-1 border border-gray-300 text-xs">${sub.type || ""}</td>
              <td class="px-3 py-1 border border-gray-300 text-xs">${m.name || ""}</td>
              <td class="px-3 py-1 border border-gray-300 text-xs">${formatDate(
                sub.startDate
              )}</td>
              <td class="px-3 py-1 border border-gray-300 text-xs">${formatDate(
                sub.endDate
              )}</td>
              <td class="px-3 py-1 border border-gray-300 text-xs">${
                sub.eventCreditsLeft ?? "-"
              }</td>
              <td class="px-3 py-1 border border-gray-300 text-xs">${
                sub.eventCreditsTotal ?? "-"
              }</td>
              <td class="px-3 py-1 border border-gray-300 text-xs">${
                sub.moneyCreditsLeft ?? "-"
              }</td>
              <td class="px-3 py-1 border border-gray-300 text-xs">${
                sub.moneyCreditsTotal ?? "-"
              }</td>
              <td class="px-3 py-1 border border-gray-300 text-xs">${
                sub.usageLimitForSessions ?? "-"
              }</td>
              <td class="px-3 py-1 border border-gray-300 text-xs">${
                sub.usedSessions ?? "-"
              }</td>
              <td class="px-3 py-1 border border-gray-300 text-xs">${
                sub.usageLimitForAppointments ?? "-"
              }</td>
              <td class="px-3 py-1 border border-gray-300 text-xs">${
                sub.usedAppointments ?? "-"
              }</td>
              <td class="px-3 py-1 border border-gray-300 text-xs">${
                sub.membership?.autoRenewing ? "Yes" : "No"
              }</td>
              <td class="px-3 py-1 border border-gray-300 text-xs">${
                sub.membership?.disabled ? "Yes" : "No"
              }</td>
            </tr>`;
        });

        html += `</tbody></table></div>`;
      }

      // Sessions Section
      html += `<h3 class="text-2xl font-semibold mb-3 text-gray-900 border-b border-gray-300 pb-1">Session Bookings</h3>`;
      if (!sessions || sessions.length === 0) {
        html +=
          '<p class="text-gray-600 mb-4">No session bookings found for this member.</p>';
      } else {
        html += `<div class="overflow-x-auto max-h-[40vh] overflow-y-auto rounded-lg shadow border border-gray-300">
          <table class="min-w-full bg-white rounded-lg">
            <thead class="bg-gray-100 sticky top-0">
              <tr>
                <th class="px-3 py-1 border border-gray-300 text-left text-xs font-semibold">Booking ID</th>
                <th class="px-3 py-1 border border-gray-300 text-left text-xs font-semibold">Session ID</th>
                <th class="px-3 py-1 border border-gray-300 text-left text-xs font-semibold">Session Name</th>
                <th class="px-3 py-1 border border-gray-300 text-left text-xs font-semibold">Type</th>
                <th class="px-3 py-1 border border-gray-300 text-left text-xs font-semibold">Starts At</th>
                <th class="px-3 py-1 border border-gray-300 text-left text-xs font-semibold">Ends At</th>
                <th class="px-3 py-1 border border-gray-300 text-left text-xs font-semibold">Teacher</th>
                <th class="px-3 py-1 border border-gray-300 text-left text-xs font-semibold">Checked In</th>
                <th class="px-3 py-1 border border-gray-300 text-left text-xs font-semibold">Cancelled</th>
                <th class="px-3 py-1 border border-gray-300 text-left text-xs font-semibold">Actions</th>
              </tr>
            </thead>
            <tbody>`;

        sessions.forEach((booking) => {
          const s = booking.session || {};
          const teacher = s.teacher
            ? `${s.teacher.firstName} ${s.teacher.lastName}`
            : "-";
          const checkedIn = booking.checkedIn ? "Yes" : "No";
          const cancelled = booking.cancelledAt ? formatDate(booking.cancelledAt) : "No";

          html += `<tr class="border-b border-gray-300 hover:bg-indigo-50 align-top">
              <td class="px-3 py-1 border border-gray-300 text-xs align-top">${booking.id}</td>
              <td class="px-3 py-1 border border-gray-300 text-xs align-top">${s.id ?? "-"}</td>
              <td class="px-3 py-1 border border-gray-300 text-xs align-top">${s.name || "-"}</td>
              <td class="px-3 py-1 border border-gray-300 text-xs align-top">${s.type || "-"}</td>
              <td class="px-3 py-1 border border-gray-300 text-xs align-top">${formatDate(s.startsAt)}</td>
              <td class="px-3 py-1 border border-gray-300 text-xs align-top">${formatDate(s.endsAt)}</td>
              <td class="px-3 py-1 border border-gray-300 text-xs align-top">${teacher}</td>
              <td class="px-3 py-1 border border-gray-300 text-xs align-top">${checkedIn}</td>
              <td class="px-3 py-1 border border-gray-300 text-xs align-top">${cancelled}</td>
              <td class="px-3 py-1 border border-gray-300 text-xs align-top space-y-1">
                <button
                  class="action-btn btn-cancel"
                  onclick="handleCancelSessionBooking(event, ${booking.id})"
                  ${booking.cancelledAt ? "disabled" : ""}
                  title="Cancel this session booking"
                >
                  <i class="fas fa-ban"></i> Cancel
                </button>
                <button
                  class="action-btn btn-not-checked-in"
                  onclick="handleMarkNotCheckedIn(event, ${booking.id})"
                  ${booking.cancelledAt || !booking.checkedIn ? "" : "disabled"}
                  title="Mark as not checked-in"
                >
                  <i class="fas fa-user-times"></i> Not Checked-In
                </button>
                <button
                  class="action-btn btn-checked-in"
                  onclick="handleMarkCheckedIn(event, ${booking.id})"
                  ${booking.cancelledAt || booking.checkedIn ? "disabled" : ""}
                  title="Mark as checked-in"
                >
                  <i class="fas fa-user-check"></i> Checked-In
                </button>
              </td>
            </tr>`;
        });

        html += `</tbody></table></div>`;
      }

      modalBody.innerHTML = html;
      modal.classList.remove("hidden");
      modal.focus();
    }

    async function handleCancelSessionBooking(event, bookingId) {
      event.stopPropagation();
      if (!confirm("Are you sure you want to cancel this session booking?")) return;
      const success = await deleteSessionBooking(bookingId);
      if (success) {
        alert("Session booking cancelled successfully.");
        // Refresh modal data by re-fetching member data
        const modal = document.getElementById("subscriptionsModal");
        if (!modal.classList.contains("hidden")) {
          // Find member id from modal title
          const modalTitle = document.getElementById("modalTitle").textContent;
          const match = modalTitle.match(/\(ID: (\d+)\)$/);
          if (match) {
            const memberId = match[1];
            const member = members.find((m) => m.id == memberId);
            if (member) {
              await onRowClick(member);
            }
          }
        }
      }
    }

    async function handleMarkNotCheckedIn(event, bookingId) {
      event.stopPropagation();
      if (!confirm("Mark this session booking as NOT checked-in?")) return;
      const success = await markSessionBookingNotCheckedIn(bookingId);
      if (success) {
        alert("Session booking marked as not checked-in.");
        // Refresh modal data
        const modal = document.getElementById("subscriptionsModal");
        if (!modal.classList.contains("hidden")) {
          const modalTitle = document.getElementById("modalTitle").textContent;
          const match = modalTitle.match(/\(ID: (\d+)\)$/);
          if (match) {
            const memberId = match[1];
            const member = members.find((m) => m.id == memberId);
            if (member) {
              await onRowClick(member);
            }
          }
        }
      }
    }

    async function handleMarkCheckedIn(event, bookingId) {
      event.stopPropagation();
      if (!confirm("Mark this session booking as checked-in?")) return;
      const success = await markSessionBookingCheckedIn(bookingId);
      if (success) {
        alert("Session booking marked as checked-in.");
        // Refresh modal data
        const modal = document.getElementById("subscriptionsModal");
        if (!modal.classList.contains("hidden")) {
          const modalTitle = document.getElementById("modalTitle").textContent;
          const match = modalTitle.match(/\(ID: (\d+)\)$/);
          if (match) {
            const memberId = match[1];
            const member = members.find((m) => m.id == memberId);
            if (member) {
              await onRowClick(member);
            }
          }
        }
      }
    }

    function renderPagination() {
      const pagination = document.getElementById("pagination");
      pagination.innerHTML = "";

      const totalPages = Math.ceil(filteredMembers.length / pageSize);
      const maxPagesToShow = 7;
      let startPage = Math.max(0, currentPage - Math.floor(maxPagesToShow / 2));
      let endPage = startPage + maxPagesToShow;
      if (endPage > totalPages) {
        endPage = totalPages;
        startPage = Math.max(0, endPage - maxPagesToShow);
      }

      const createButton = (text, disabled, onClick, extraClasses = "") => {
        const btn = document.createElement("button");
        btn.textContent = text;
        btn.disabled = disabled;
        btn.className =
          "px-3 py-2 mx-1 rounded-lg font-semibold transition-all " +
          (disabled
            ? "bg-gray-300 cursor-not-allowed text-gray-500"
            : "bg-blue-600 hover:bg-blue-700 text-white shadow-sm hover:shadow-md") +
          " " +
          extraClasses;
        btn.addEventListener("click", onClick);
        return btn;
      };

      if (totalPages > 1) {
        pagination.appendChild(
          createButton("First", currentPage === 0, () => {
            currentPage = 0;
            renderTable();
          })
        );
        pagination.appendChild(
          createButton("Prev", currentPage === 0, () => {
            if (currentPage > 0) {
              currentPage--;
              renderTable();
            }
          })
        );

        for (let i = startPage; i < endPage; i++) {
          const btn = createButton(
            (i + 1).toString(),
            false,
            () => {
              currentPage = i;
              renderTable();
            },
            currentPage === i ? "bg-blue-800 shadow-md" : ""
          );
          pagination.appendChild(btn);
        }

        pagination.appendChild(
          createButton("Next", currentPage >= totalPages - 1, () => {
            if (currentPage < totalPages - 1) {
              currentPage++;
              renderTable();
            }
          })
        );
        pagination.appendChild(
          createButton("Last", currentPage >= totalPages - 1, () => {
            currentPage = totalPages - 1;
            renderTable();
          })
        );
      }
    }

    function formatDate(dateString) {
      if (!dateString) return "-";
      const date = new Date(dateString);
      if (isNaN(date)) return "-";
      return date.toLocaleString("en-IN", {
        timeZone: "Asia/Kolkata",
        hour12: true,
        year: "numeric",
        month: "short",
        day: "numeric",
        hour: "2-digit",
        minute: "2-digit",
      });
    }

    function sortTable(column) {
      // Enhanced sorting: toggle asc/desc, numeric or string
      const header = document.getElementById(column);
      let direction = header.dataset.sortDirection || "asc";
      direction = direction === "asc" ? "desc" : "asc";
      header.dataset.sortDirection = direction;
      currentSort = { column, direction };

      // Reset other headers
      document.querySelectorAll("thead th").forEach((th) => {
        if (th.id !== column) {
          th.dataset.sortDirection = "";
          // Remove sort icons
          const icon = th.querySelector('i');
          if (icon) {
            icon.className = 'fas fa-sort';
          }
        }
      });

      // Update current header icon
      const currentIcon = header.querySelector('i');
      if (currentIcon) {
        currentIcon.className = direction === 'asc' ? 'fas fa-sort-up' : 'fas fa-sort-down';
      }

      filteredMembers.sort((a, b) => {
        let aVal = a[column];
        let bVal = b[column];

        // Special handling for visits.total and visits.totalVisits
        if (column === "total" || column === "totalVisits") {
          aVal = a.visits?.[column] ?? 0;
          bVal = b.visits?.[column] ?? 0;
        }

        // Handle null or undefined
        if (aVal === null || aVal === undefined) aVal = "";
        if (bVal === null || bVal === undefined) bVal = "";

        // Numeric sort if both are numbers
        if (!isNaN(aVal) && !isNaN(bVal)) {
          return direction === "asc" ? aVal - bVal : bVal - aVal;
        }

        // String sort
        aVal = aVal.toString().toLowerCase();
        bVal = bVal.toString().toLowerCase();

        if (aVal < bVal) return direction === "asc" ? -1 : 1;
        if (aVal > bVal) return direction === "asc" ? 1 : -1;
        return 0;
      });

      currentPage = 0; // Reset to first page after sorting
      renderTable();
    }

    function searchTable() {
      applyFilters();
    }

    function renderFilteredTable(filteredMembers) {
      const tableBody = document.getElementById("membersTableBody");
      tableBody.innerHTML = "";

      filteredMembers.forEach((member) => {
        const row = document.createElement("tr");
        row.classList.add(
          "border-b",
          "hover:bg-indigo-100",
          "transition",
          "duration-200",
          "ease-in-out",
          "cursor-pointer",
          "select-none"
        );

        row.innerHTML = `
                  <td class="px-4 py-0.5 text-sm font-semibold">${member.id}</td>
                  <td class="px-4 py-0.5 text-sm font-medium">${member.firstName || ""}</td>
                  <td class="px-4 py-0.5 text-sm font-medium">${member.lastName || ""}</td>
                  <td class="px-4 py-0.5 text-sm truncate max-w-[150px]" title="${member.email || ""}">${member.email || ""}</td>
                  <td class="px-4 py-0.5 text-sm">${getCountryFlag(
                    member.phoneNumber || ""
                  )} <span class="align-middle">${member.phoneNumber || ""}</span></td>
                  <td class="px-4 py-0.5 text-sm">${formatDate(member.firstSeen)}</td>
                  <td class="px-4 py-0.5 text-sm">${formatDate(member.lastSeen)}</td>
                  <td class="px-4 py-0.5 text-sm font-semibold">${member.visits?.total ?? ""}</td>
                  <td class="px-4 py-0.5 text-sm font-semibold">${member.visits?.totalVisits ?? ""}</td>
              `;

        row.addEventListener("click", () => onRowClick(member));

        tableBody.appendChild(row);
      });
    }

    function getCountryFlag(phoneNumber) {
      if (!phoneNumber) return '<span class="flag-icon flag-icon-unknown"></span>';
      const countryCode = phoneNumber.split(" ")[0];
      switch (countryCode) {
        case "+1":
          return '<span class="flag-icon flag-icon-us"></span>';
        case "+91":
          return '<span class="flag-icon flag-icon-in"></span>';
        case "+44":
          return '<span class="flag-icon flag-icon-gb"></span>';
        case "+61":
          return '<span class="flag-icon flag-icon-au"></span>';
        case "+81":
          return '<span class="flag-icon flag-icon-jp"></span>';
        default:
          return '<span class="flag-icon flag-icon-unknown"></span>';
      }
    }

    // Modal close handlers
    function closeModal() {
      const modal = document.getElementById("subscriptionsModal");
      modal.classList.add("hidden");
    }
    // Close modal on outside click
    window.addEventListener("click", (e) => {
      const modal = document.getElementById("subscriptionsModal");
      if (!modal.classList.contains("hidden") && e.target === modal) {
        closeModal();
      }
    });
    // Close modal on Escape key
    window.addEventListener("keydown", (e) => {
      if (e.key === "Escape") {
        const modal = document.getElementById("subscriptionsModal");
        if (!modal.classList.contains("hidden")) {
          closeModal();
        }
      }
    });

    // Export member data from modal
    function exportMemberData() {
      const modalTitle = document.getElementById("modalTitle").textContent;
      const match = modalTitle.match(/\(ID: (\d+)\)$/);
      if (match) {
        const memberId = match[1];
        const member = members.find(m => m.id == memberId);
        if (member) {
          const csvContent = generateCSV([member]);
          downloadFile(csvContent, `member-${memberId}.csv`, 'text/csv');
          showToast('Member data exported successfully', 'success');
        }
      }
    }

    // Initialize application
    function initializeApp() {
      initializeTheme();
      showLoading();
      authenticate().then(() => {
        initializeCharts();
      });
    }

    document.addEventListener("DOMContentLoaded", initializeApp);
  </script>
</head>
<body data-theme="light">
  <!-- Toast Container -->
  <div class="toast-container" id="toastContainer"></div>

  <!-- Sidebar -->
  <div class="sidebar fixed left-0 top-0 h-full z-30" id="sidebar">
    <div class="sidebar-header">
      <div class="flex items-center gap-4">
        <div class="sidebar-logo">
          <i class="fas fa-users text-white text-xl"></i>
        </div>
        <div>
          <h1 class="text-xl font-bold text-gray-900">Momence</h1>
          <p class="text-sm text-gray-500 font-medium">Customer Management</p>
        </div>
      </div>
    </div>
    
    <nav class="sidebar-nav">
      <a href="#" class="sidebar-item active" data-aos="fade-right" data-aos-delay="100">
        <i class="fas fa-chart-line"></i>
        <span>Dashboard</span>
      </a>
      <a href="#" class="sidebar-item" data-aos="fade-right" data-aos-delay="200">
        <i class="fas fa-users"></i>
        <span>Customer Management</span>
      </a>
      <a href="#" class="sidebar-item" data-aos="fade-right" data-aos-delay="300">
        <i class="fas fa-chart-bar"></i>
        <span>Analytics & Reports</span>
      </a>
      <a href="#" class="sidebar-item" data-aos="fade-right" data-aos-delay="400">
        <i class="fas fa-cog"></i>
        <span>Settings</span>
      </a>
    </nav>
  </div>

  <!-- Main Content -->
  <div class="main-content" style="margin-left: 320px; min-height: 100vh;">
    <!-- Header -->
    <header class="bg-white/80 backdrop-blur-md border-b border-gray-200/50 px-8 py-6 sticky top-0 z-20" data-aos="fade-down">
      <div class="flex items-center justify-between">
        <div class="flex items-center gap-6">
          <button class="lg:hidden btn btn-ghost" onclick="toggleSidebar()">
            <i class="fas fa-bars"></i>
          </button>
          <div>
            <h2 class="text-2xl font-bold text-gray-900 mb-1">Customer Dashboard</h2>
            <p class="text-gray-600 font-medium">Manage and analyze your customer base</p>
          </div>
        </div>
        
        <div class="flex items-center gap-4">
          <!-- Search -->
          <div class="hidden md:flex relative">
            <input
              type="text"
              placeholder="Quick search..."
              class="w-64 pl-10 pr-4 py-2 border border-gray-200 rounded-lg bg-gray-50/50 focus:bg-white focus:border-blue-500 transition-all duration-200"
            />
            <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
          </div>
          
          <!-- Theme Toggle -->
          <div class="theme-toggle" onclick="toggleTheme()" id="themeToggle"></div>
          
          <!-- Notifications -->
          <button class="btn btn-ghost relative">
            <i class="fas fa-bell"></i>
            <span class="absolute -top-1 -right-1 w-3 h-3 bg-red-500 rounded-full animate-pulse"></span>
          </button>
          
          <!-- User Profile -->
          <div class="dropdown" id="userDropdown">
            <button class="flex items-center gap-3 btn btn-ghost" onclick="toggleDropdown('userDropdown')">
              <img src="https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=40&h=40&fit=crop&crop=face&auto=format" alt="User" class="w-10 h-10 rounded-full border-2 border-gray-200">
              <div class="hidden md:block text-left">
                <div class="font-semibold text-gray-900">Admin User</div>
                <div class="text-xs text-gray-500">Administrator</div>
              </div>
              <i class="fas fa-chevron-down text-xs text-gray-400"></i>
            </button>
            <div class="dropdown-content">
              <a href="#" class="dropdown-item">
                <i class="fas fa-user"></i> Profile Settings
              </a>
              <a href="#" class="dropdown-item">
                <i class="fas fa-cog"></i> Preferences
              </a>
              <hr class="border-gray-200 my-1">
              <a href="#" class="dropdown-item">
                <i class="fas fa-sign-out-alt"></i> Sign Out
              </a>
            </div>
          </div>
        </div>
      </div>
    </header>

    <!-- Dashboard Content -->
    <main class="p-8">
      <!-- Statistics Cards -->
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
        <div class="premium-card p-6" data-aos="fade-up" data-aos-delay="100">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-sm font-medium text-gray-600 mb-1">Total Customers</p>
              <p class="text-3xl font-bold text-gray-900" id="totalMembersCount">-</p>
              <p class="text-xs text-gray-500 mt-2 flex items-center gap-1">
                <i class="fas fa-arrow-up text-green-500"></i>
                <span class="text-green-600 font-semibold">+12.5%</span> vs last month
              </p>
            </div>
            <div class="w-16 h-16 bg-gradient-to-br from-blue-500 to-blue-600 rounded-2xl flex items-center justify-center shadow-lg">
              <i class="fas fa-users text-white text-2xl"></i>
            </div>
          </div>
        </div>

        <div class="premium-card p-6" data-aos="fade-up" data-aos-delay="200">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-sm font-medium text-gray-600 mb-1">Active Customers</p>
              <p class="text-3xl font-bold text-gray-900" id="activeSubscriptionsCount">-</p>
              <p class="text-xs text-gray-500 mt-2 flex items-center gap-1">
                <i class="fas fa-arrow-up text-green-500"></i>
                <span class="text-green-600 font-semibold">+8.2%</span> vs last month
              </p>
            </div>
            <div class="w-16 h-16 bg-gradient-to-br from-green-500 to-green-600 rounded-2xl flex items-center justify-center shadow-lg">
              <i class="fas fa-user-check text-white text-2xl"></i>
            </div>
          </div>
        </div>

        <div class="premium-card p-6" data-aos="fade-up" data-aos-delay="300">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-sm font-medium text-gray-600 mb-1">New This Month</p>
              <p class="text-3xl font-bold text-gray-900" id="todaysSessionsCount">-</p>
              <p class="text-xs text-gray-500 mt-2 flex items-center gap-1">
                <i class="fas fa-arrow-up text-green-500"></i>
                <span class="text-green-600 font-semibold">+15.3%</span> vs last month
              </p>
            </div>
            <div class="w-16 h-16 bg-gradient-to-br from-purple-500 to-purple-600 rounded-2xl flex items-center justify-center shadow-lg">
              <i class="fas fa-user-plus text-white text-2xl"></i>
            </div>
          </div>
        </div>

        <div class="premium-card p-6" data-aos="fade-up" data-aos-delay="400">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-sm font-medium text-gray-600 mb-1">Customer Value</p>
              <p class="text-3xl font-bold text-gray-900">2.8M</p>
              <p class="text-xs text-gray-500 mt-2 flex items-center gap-1">
                <i class="fas fa-arrow-up text-green-500"></i>
                <span class="text-green-600 font-semibold">+22.1%</span> vs last month
              </p>
            </div>
            <div class="w-16 h-16 bg-gradient-to-br from-yellow-500 to-orange-500 rounded-2xl flex items-center justify-center shadow-lg">
              <i class="fas fa-chart-line text-white text-2xl"></i>
            </div>
          </div>
        </div>
      </div>

      <!-- Charts Section -->
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
        <div class="premium-card p-6" data-aos="fade-up" data-aos-delay="500">
          <div class="flex items-center justify-between mb-6">
            <h3 class="text-lg font-bold text-gray-900">Customer Growth Trend</h3>
            <div class="flex items-center gap-2 text-sm text-gray-600">
              <span class="w-3 h-3 bg-blue-500 rounded-full"></span>
              <span>New Customers</span>
            </div>
          </div>
          <div class="relative h-64">
            <canvas id="memberGrowthChart"></canvas>
          </div>
        </div>
        
        <div class="premium-card p-6" data-aos="fade-up" data-aos-delay="600">
          <div class="flex items-center justify-between mb-6">
            <h3 class="text-lg font-bold text-gray-900">Customer Segments</h3>
            <button class="btn btn-ghost text-sm">
              <i class="fas fa-external-link-alt"></i>
              View Details
            </button>
          </div>
          <div class="relative h-64">
            <canvas id="sessionTypesChart"></canvas>
          </div>
        </div>
      </div>

      <!-- Advanced Filters -->
      <div class="premium-card p-6 mb-8" data-aos="fade-up" data-aos-delay="700">
        <div class="flex items-center justify-between mb-6">
          <h3 class="text-lg font-bold text-gray-900">Advanced Filters & Search</h3>
          <button class="btn btn-secondary text-sm" onclick="clearFilters()">
            <i class="fas fa-times"></i>
            Reset All
          </button>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-3">Search Customers</label>
            <div class="relative">
              <input
                id="searchInput"
                type="text"
                placeholder="Name, email, or phone..."
                class="form-input pl-10"
                oninput="searchTable()"
              />
              <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
            </div>
          </div>
          
          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-3">Customer Status</label>
            <div class="dropdown" id="statusDropdown">
              <button class="form-input text-left flex items-center justify-between w-full" onclick="toggleDropdown('statusDropdown')">
                <span id="statusFilterText">All Statuses</span>
                <i class="fas fa-chevron-down text-sm text-gray-400"></i>
              </button>
              <div class="dropdown-content">
                <button class="dropdown-item" onclick="setStatusFilter('all')">
                  <i class="fas fa-users"></i> All Statuses
                </button>
                <button class="dropdown-item" onclick="setStatusFilter('active')">
                  <i class="fas fa-user-check text-green-500"></i> Active Customers
                </button>
                <button class="dropdown-item" onclick="setStatusFilter('inactive')">
                  <i class="fas fa-user-times text-gray-400"></i> Inactive Customers
                </button>
                <button class="dropdown-item" onclick="setStatusFilter('new')">
                  <i class="fas fa-user-plus text-blue-500"></i> New Customers
                </button>
              </div>
            </div>
          </div>
          
          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-3">Date Range</label>
            <input
              id="dateRange"
              type="text"
              placeholder="Select date range"
              class="form-input"
              readonly
            />
          </div>
          
          <div class="flex items-end">
            <button class="btn btn-primary w-full" onclick="applyFilters()">
              <i class="fas fa-search"></i>
              Apply Filters
            </button>
          </div>
        </div>
        
        <!-- Active Filters -->
        <div id="activeFilters" class="mt-6 flex flex-wrap gap-3"></div>
      </div>

      <!-- Action Bar -->
      <div class="stats-card mb-6">
        <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
          <div class="flex items-center gap-4">
            <div class="flex items-center gap-2">
              <input type="checkbox" id="selectAll" class="rounded border-gray-300" onchange="toggleSelectAll()">
              <label for="selectAll" class="text-sm font-medium text-gray-700">Select All</label>
            </div>
            <span class="text-sm text-gray-500" id="selectedCount">0 selected</span>
          </div>
          
          <div class="flex flex-wrap gap-3">
            <!-- Bulk Actions -->
            <div class="dropdown" id="bulkActionsDropdown">
              <button class="btn btn-secondary" onclick="toggleDropdown('bulkActionsDropdown')" id="bulkActionsBtn" disabled>
                <i class="fas fa-ellipsis-h"></i>
                Bulk Actions
                <i class="fas fa-chevron-down text-xs"></i>
              </button>
              <div class="dropdown-content">
                <button class="dropdown-item" onclick="bulkExport()">
                  <i class="fas fa-download mr-2"></i> Export Selected
                </button>
                <button class="dropdown-item" onclick="bulkDelete()">
                  <i class="fas fa-trash mr-2"></i> Delete Selected
                </button>
                <button class="dropdown-item" onclick="bulkEmail()">
                  <i class="fas fa-envelope mr-2"></i> Send Email
                </button>
              </div>
            </div>
            
            <!-- Export Options -->
            <div class="dropdown" id="exportDropdown">
              <button class="btn btn-primary" onclick="toggleDropdown('exportDropdown')">
                <i class="fas fa-download"></i>
                Export
                <i class="fas fa-chevron-down text-xs"></i>
              </button>
              <div class="dropdown-content">
                <button class="dropdown-item" onclick="exportToCSV()">
                  <i class="fas fa-file-csv mr-2"></i> Export as CSV
                </button>
                <button class="dropdown-item" onclick="exportToPDF()">
                  <i class="fas fa-file-pdf mr-2"></i> Export as PDF
                </button>
                <button class="dropdown-item" onclick="exportToExcel()">
                  <i class="fas fa-file-excel mr-2"></i> Export as Excel
                </button>
              </div>
            </div>
            
            <!-- Quick Sort -->
            <div class="dropdown" id="sortDropdown">
              <button class="btn btn-ghost" onclick="toggleDropdown('sortDropdown')">
                <i class="fas fa-sort"></i>
                Quick Sort
                <i class="fas fa-chevron-down text-xs"></i>
              </button>
              <div class="dropdown-content">
                <button class="dropdown-item" onclick="quickSort('firstName')">
                  <i class="fas fa-sort-alpha-down mr-2"></i> First Name
                </button>
                <button class="dropdown-item" onclick="quickSort('lastName')">
                  <i class="fas fa-sort-alpha-down mr-2"></i> Last Name
                </button>
                <button class="dropdown-item" onclick="quickSort('email')">
                  <i class="fas fa-envelope mr-2"></i> Email
                </button>
                <button class="dropdown-item" onclick="quickSort('total')">
                  <i class="fas fa-calendar-check mr-2"></i> Total Bookings
                </button>
                <button class="dropdown-item" onclick="quickSort('totalVisits')">
                  <i class="fas fa-users mr-2"></i> Total Visits
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

        
        <!-- Customer Data Table -->
        <div class="overflow-x-auto">
          <table class="min-w-full" role="grid" aria-label="Customer Management Table">
            <thead class="bg-gray-50 border-b border-gray-200">
              <tr>
                <th class="px-6 py-4 text-left">
                  <input type="checkbox" id="headerCheckbox" class="rounded border-gray-300 text-blue-600 focus:ring-blue-500" onchange="toggleSelectAll()">
                </th>
                <th class="px-6 py-4 cursor-pointer select-none text-left text-sm font-bold text-gray-700 tracking-wide" id="id" onclick="sortTable('id')">
                  ID <i class="fas fa-sort ml-1 text-gray-400"></i>
                </th>
                <th class="px-6 py-4 cursor-pointer select-none text-left text-sm font-bold text-gray-700 tracking-wide" id="firstName" onclick="sortTable('firstName')">
                  Customer Name <i class="fas fa-sort ml-1 text-gray-400"></i>
                </th>
                <th class="px-6 py-4 cursor-pointer select-none text-left text-sm font-bold text-gray-700 tracking-wide" id="email" onclick="sortTable('email')">
                  Contact Information <i class="fas fa-sort ml-1 text-gray-400"></i>
                </th>
                <th class="px-6 py-4 cursor-pointer select-none text-left text-sm font-bold text-gray-700 tracking-wide" id="firstSeen" onclick="sortTable('firstSeen')">
                  First Contact <i class="fas fa-sort ml-1 text-gray-400"></i>
                </th>
                <th class="px-6 py-4 cursor-pointer select-none text-left text-sm font-bold text-gray-700 tracking-wide" id="lastSeen" onclick="sortTable('lastSeen')">
                  Last Activity <i class="fas fa-sort ml-1 text-gray-400"></i>
                </th>
                <th class="px-6 py-4 cursor-pointer select-none text-left text-sm font-bold text-gray-700 tracking-wide" id="totalVisits" onclick="sortTable('totalVisits')">
                  Engagement <i class="fas fa-sort ml-1 text-gray-400"></i>
                </th>
                <th class="px-6 py-4 text-left text-sm font-bold text-gray-700 tracking-wide">Status</th>
                <th class="px-6 py-4 text-center text-sm font-bold text-gray-700 tracking-wide">Actions</th>
              </tr>
            </thead>
            <tbody id="membersTableBody" role="rowgroup" class="divide-y divide-gray-100">
              <!-- Customer data will be inserted here -->
            </tbody>
          </table>
        </div>
        
        <!-- Enhanced Pagination -->
        <div class="px-6 py-4 border-t border-gray-100 bg-gradient-to-r from-gray-50 to-white">
          <div class="flex items-center justify-between">
            <div class="flex items-center gap-4">
              <div class="text-sm font-medium text-gray-700">
                Showing <span id="showingStart" class="font-bold text-blue-600">0</span> to <span id="showingEnd" class="font-bold text-blue-600">0</span> of <span id="totalRecords" class="font-bold text-blue-600">0</span> customers
              </div>
              <div class="text-xs text-gray-500">
                Updated just now
              </div>
            </div>
            <div id="pagination" class="flex items-center gap-2"></div>
          </div>
        </div>
    </main>
  </div>

  <!-- Enhanced Customer Details Modal -->
  <div
    id="subscriptionsModal"
    class="fixed inset-0 modal-backdrop flex items-center justify-center p-6 hidden z-50"
    role="dialog"
    aria-modal="true"
    aria-labelledby="modalTitle"
    tabindex="-1"
  >
    <div
      class="modal-content max-w-5xl w-full max-h-[90vh] overflow-hidden flex flex-col rounded-2xl shadow-2xl focus:outline-none bg-white"
      role="document"
    >
      <div
        class="flex justify-between items-center border-b border-gray-200 px-8 py-6 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-t-2xl"
      >
        <div class="flex items-center gap-4">
          <div class="w-12 h-12 bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl flex items-center justify-center shadow-lg">
            <i class="fas fa-user text-white text-lg"></i>
          </div>
          <div>
            <h2
              id="modalTitle"
              class="text-2xl font-bold text-gray-900 select-text"
              tabindex="0"
            >Customer Details</h2>
            <p class="text-sm text-gray-600 mt-1">Comprehensive customer information and analytics</p>
          </div>
        </div>
        <button
          aria-label="Close modal"
          class="w-10 h-10 flex items-center justify-center rounded-lg border border-gray-200 bg-white text-gray-400 hover:text-gray-600 hover:bg-gray-50 transition-all duration-200"
          onclick="closeModal()"
          title="Close"
          type="button"
        >
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div
        id="modalBody"
        class="p-8 overflow-y-auto bg-white flex-1"
        style="min-height: 300px;"
      ></div>
      <div
        class="flex justify-end gap-3 border-t border-gray-200 px-8 py-6 bg-gray-50 rounded-b-2xl"
      >
        <button
          class="btn btn-secondary"
          onclick="closeModal()"
          aria-label="Close modal"
          type="button"
        >
          <i class="fas fa-times"></i>
          Close
        </button>
        <button
          class="btn btn-primary"
          onclick="exportMemberData()"
          aria-label="Export customer data"
          type="button"
        >
          <i class="fas fa-download"></i>
          Export Customer Data
        </button>
      </div>
    </div>
  </div>
  
  <!-- AOS Animation Script -->
  <script>
    AOS.init({
      duration: 800,
      easing: 'ease-out-cubic',
      once: true,
      offset: 100
    });
  </script>
</body>
</html>